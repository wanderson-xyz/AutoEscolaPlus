Quero adaptar este projeto para deploy na Vercel.
Atualmente ele tem uma estrutura com client/ (Vite + React SPA) e server/ (Express + TypeScript), mas a Vercel nÃ£o mantÃ©m processos Node long-running, entÃ£o precisamos migrar para funÃ§Ãµes serverless.

FaÃ§a todas as modificaÃ§Ãµes listadas abaixo:

ğŸ”¹ 1. Migrar o backend Express para funÃ§Ãµes serverless

Criar uma pasta api/ na raiz com os seguintes arquivos:

api/_db.ts: helper que conecta ao Postgres usando Drizzle ORM + Neon (@neondatabase/serverless).

api/contact.ts: rota POST que valida com Zod (insertContactSchema) e insere no banco (contacts).

api/contacts.ts: rota GET que lista contatos em ordem decrescente de createdAt.

Reaproveitar shared/schema.ts (jÃ¡ existe).

Parar de usar MemStorage (nÃ£o funciona em ambiente serverless).

ğŸ”¹ 2. Conectar ao banco Neon / Postgres

Usar a variÃ¡vel de ambiente DATABASE_URL.

Incluir verificaÃ§Ã£o de erro caso nÃ£o esteja definida.

Antes do primeiro deploy, rodar npm run db:push para criar as tabelas.

Documentar que DATABASE_URL deve ser configurada nos Secrets do Replit e depois nas Environment Variables da Vercel.

ğŸ”¹ 3. ConfiguraÃ§Ã£o da Vercel

Criar um vercel.json na raiz com:

{
  "version": 2,
  "functions": {
    "api/**/*.ts": { "runtime": "nodejs20.x" }
  },
  "builds": [
    {
      "src": "client/**",
      "use": "@vercel/static-build",
      "config": {
        "distDir": "dist/public",
        "buildCommand": "npm run vercel-build"
      }
    },
    {
      "src": "api/**/*.ts",
      "use": "@vercel/node"
    }
  ],
  "rewrites": [
    { "source": "/api/(.*)", "destination": "/api/$1" },
    { "source": "/(.*)", "destination": "/index.html" }
  ]
}

ğŸ”¹ 4. Ajustar package.json

Adicionar script:

"vercel-build": "vite build"


Adicionar engines:

"engines": { "node": ">=20" }


Manter o script "build" original apenas para Replit (vite build && esbuild ...).

A Vercel deve usar somente "vercel-build".

ğŸ”¹ 5. Ajustar vite.config.ts

Plugins do Replit (runtimeErrorOverlay, cartographer) devem ser usados apenas em dev.

Envolver em condiÃ§Ã£o:

...(process.env.NODE_ENV !== "production" ? [runtimeErrorOverlay()] : [])

ğŸ”¹ 6. Limpeza do projeto

Remover a pasta server/ se nÃ£o for mais necessÃ¡ria.

Garantir que node_modules/ e .git/ nÃ£o estejam dentro do projeto enviado para a Vercel.

ğŸ”¹ 7. Passos de deploy

Configurar DATABASE_URL no Replit (Secrets).

Rodar npm run db:push para aplicar migrations.

Commitar as mudanÃ§as.

Importar projeto na Vercel.

Definir DATABASE_URL em Environment Variables da Vercel.

Deploy.

ğŸ”¹ 8. Resultado esperado

POST /api/contact â†’ salva contato no banco.

GET /api/contacts â†’ retorna todos os contatos ordenados por createdAt desc.

Rotas SPA (/about, /services, etc.) funcionam direto (fallback para index.html).

â¡ï¸ Tarefas finais para vocÃª (Replit AI):

Criar os arquivos novos (api/_db.ts, api/contact.ts, api/contacts.ts, vercel.json).

Alterar package.json e vite.config.ts conforme descrito.

Remover o backend Express (server/) e dependÃªncias associadas.

Me entregar o projeto pronto para rodar npm run dev no Replit e deployar na Vercel sem ajustes manuais.